<p align="center">
  <img src="https://github.com/intel/terraform-intel-azure-mssql-managed-instance/blob/main/images/logo-classicblue-800px.png?raw=true" alt="Intel Logo" width="250"/>
</p>


# Intel® Optimized Cloud Modules for Terraform

© Copyright 2024, Intel Corporation

## Azure MSSQL Managed Instance Vulnerability Assessment Example
The example provisions a MSSQL managed instance, storage container, storage account, security alert policy, and a vulnerability assessment. According the Microsoft documentation, the purpose of a vulnerability assessment is to give insights into the security state of the instance, and it gives actionable steps to investigate, manage, and resolve security issues. 

The code creates an Azure storage account to have a place for the audit log to be stored and a container to organize those files similar to a directory in a file system. By default, storage account is denied access from public.


The Instance Selection and Intel Optimizations have been defaulted in the code.


More information can be found here: 
[Enable Vulnerability Assessment on your Azure SQL Databases](<https://learn.microsoft.com/en-us/azure/defender-for-cloud/sql-azure-vulnerability-assessment-enable>)

[Intro to Azure Blob Storage, Storage Accounts, and Containers](<https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction>)

The example deploys an Intel Optimized Azure MSSQL Managed Instance. Instance Selection and Intel Optimizations have been defaulted in the code.

The code selects premium Series - memory optimized Gen5 based on the Intel(R) Xeon Scalable 2.8 GHz processor (Ice Lake) processors.

This module uses a predefined resource group, virtual network, subnet, and network security group. 

<p align="center">
<img src="https://github.com/intel/terraform-intel-azure-mssql-managed-instance/blob/main/images/requirements.png?raw=true" alt="Important Notice" width="600">
</p>



## Important Notice
<img src="https://github.com/intel/terraform-intel-azure-mssql-managed-instance/blob/main/images/important_notice_mssql_managed_instance.png?raw=true" alt="Important Notice" width="600"/>

## **Provisioning an Azure MSSQL Managed Instance can take up to 6 hours!**
More information can be found [Overview of Azure SQL Managed Instance management operations.](https://learn.microsoft.com/en-us/azure/azure-sql/managed-instance/management-operations-overview?view=azuresql)

## Usage
See examples folder for code ./examples/intel-optimized-azure-mssql-managed-server/main.tf

Example of main.tf

```hcl
# Example of how to pass variable for instance password:
# terraform apply -var="administrator_login_password=..."
# Environment variables can also be used https://www.terraform.io/language/values/variables#environment-variables

# Provision Intel Cloud Optimization Module

# variables.tf

  variable "administrator_login_password" {
  description = "Password for the admin login user."
  type        = string
  sensitive   = true
}

# main.tf
module "optimized-mssql-managed-instance" {
  vm_name                      = "terraformtestingexample"
  source                       = "intel/azure-mssql-managed-instance/intel"
  administrator_login_password = var.administrator_login_password
  resource_group_name          = "<ENTER_RESOURCE_GROUP_NAME>"
  license_type                 = "BasePrice"
  sku_name                     = "GP_Gen5"
  storage_size_in_gb           = 32
  tags                         = {
    owner       = "owner@company.com"
    duration    = "4"
  }
}

```

Run Terraform

```hcl
terraform init  
terraform plan
terraform apply



```

Note that this example may create resources. Run `terraform destroy` when you don't need these resources anymore.

## Considerations  

It is important to either create or associate a predefined a route table to a SQL managed instance subnet that will be associated with the network security group. More details can be found here: https://learn.microsoft.com/en-us/azure/azure-sql/managed-instance/vnet-existing-add-subnet?view=azuresql

More information about pricing and sku types can be found at: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/mssql_managed_instance.

It is important to choose the sku types and vcore options based off of the Terraform documentation and not the pricing calculator because those are the only options that the Azure provider supports.





